---

template_files:
  - src: DOCKERFILES/Dockerfile-base.j2
    dst: "../../Dockerfiles/base/Dockerfile-{{ php_version }}"
  - src: DOCKERFILES/Dockerfile-mods.j2
    dst: "../../Dockerfiles/mods/Dockerfile-{{ php_version }}"
  - src: DOCKERFILES/Dockerfile-prod.j2
    dst: "../../Dockerfiles/prod/Dockerfile-{{ php_version }}"
  - src: DOCKERFILES/Dockerfile-work.j2
    dst: "../../Dockerfiles/work/Dockerfile-{{ php_version }}"




# Adds self-validating checks to Dockerfile
# turn off for final build
debug: True


php_all_versions:
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - 7.2


php_conf_dir: /usr/local/etc/php.d


###
### Extensions to actually enable
###
extensions_enabled:
  - amqp
  - apcu
  - bcmath
  - bz2
  - calendar
  - ctype
  - curl
  - dba
  - dom
  - enchant
  - exif
  - fileinfo
  - filter
  - ftp
  - gd
  - gettext
  - gmp
  - hash
  - iconv
  - igbinary
  - imagick
  - imap
  - interbase
  - intl
  - json
  - ldap
  - libxml
  - mbstring
  - mcrypt
  - memcache
  - memcached
  - mongodb
  - msgpack
  - mysql
  - mysqli
  - mysqlnd
  - oci8
  - odbc
  - opcache
  - openssl
  - pcntl
  - pcre
  - pdo
  - pdo_dblib
  - pdo_firebird
  - pdo_mysql
  - pdo_oci
  - pdo_odbc
  - pdo_pgsql
  - pdo_sqlite
  - pgsql
  - phalcon
  - phar
  - posix
  - pspell
  - readline
  - recode
  - redis
  - session
  - shmop
  - simplexml
  - snmp
  - soap
  - sockets
  - sodium
  - spl
  - swoole
  - sysvmsg
  - sysvsem
  - sysvshm
  - tidy
  - tokenizer
  - uploadprogress
  - wddx
  - xdebug
  - xml
  - xmlreader
  - xmlrpc
  - xmlwriter
  - xsl
  - zip


###
### All available php modules
###

# all: is generic version of defines
# 7.2: is specific version of defines
# disabled: [optional] Array of PHP versions for which to disable this module
#
# all, 7.2, 7.1, 7.0, 5.6, 5.5, 5.4:
#   pre:       [optional] Run command before anything else
#   build_dep: [optional] Array of build dependencies
#   run_dep:   [optional] Array of run-time dependencies
#   type:      [required] One of 'builtin', 'pecl' or 'git'
#
# type: builtin
#   configure: [optional] Add './configure' arguments
# type: pecl
#   version:   [optional] Pecl packet version
#   command:   [optional] Overwrite pecl command (pecl install ext)
# type: git
#   git_url:   [required] Git repository URL
#   git_ref:   [optional] Tag, branch, commit to checkout
#   configure: [optional] Add './configure' arguments
#   command:   [optional] Overwrite default command (phpize && ./configure && make && make install)
extensions_available:
  amqp:
    7.2:
      type: pecl
      run_dep: [librabbitmq4]
    all:
      type: pecl
      command: echo "/usr" | pecl install amqp
      build_dep: [librabbitmq-dev]
      run_dep: [librabbitmq1]
  apcu:
    5.4:
      type: pecl
      version: 4.0.11
    5.5:
      type: pecl
      version: 4.0.11
    5.6:
      type: pecl
      version: 4.0.11
    all:
      type: pecl
  bcmath:
    all:
      type: builtin
  bz2:
    all:
      type: builtin
      build_dep: [libbz2-dev]
  calendar:
    all:
      type: builtin
  ctype:
    all:
      type: builtin
  curl:
    all:
      type: builtin
      build_dep: [libcurl4-openssl-dev]
  dba:
    all:
      type: builtin
  dom:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  enchant:
    all:
      type: builtin
      build_dep: [libenchant-dev]
      run_dep: [libenchant1c2a]
  exif:
    all:
      type: builtin
  fileinfo:
    all:
      type: builtin
  filter:
    disabled: "{{ php_all_versions }}" # Available by default
  ftp:
    all:
      type: builtin
      configure: --with-openssl-dir
      build_dep: [libssl-dev]
  gd:
    7.2:
      type: builtin
      configure: --with-gd --with-webp-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-zlib-dir=/usr --with-xpm-dir=/usr --with-freetype-dir=/usr --enable-gd-jis-conv
      build_dep: [libpng-dev, libjpeg-dev, libxpm-dev, libvpx-dev, zlib1g-dev, libfreetype6-dev, libwebp-dev]
      run_dep: [libpng16-16, libjpeg62-turbo, libxpm4, libvpx4, libfreetype6, libwebp6]
    7.1:
      type: builtin
      configure: --with-gd --with-webp-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-zlib-dir=/usr --with-xpm-dir=/usr --with-freetype-dir=/usr --enable-gd-jis-conv --enable-gd-native-ttf
      build_dep: [libpng-dev, libjpeg-dev, libxpm-dev, libvpx-dev, zlib1g-dev, libfreetype6-dev, libwebp-dev]
      run_dep: [libpng12-0, libjpeg62-turbo, libxpm4, libvpx1, libfreetype6, libwebp-dev]
    7.0:
      type: builtin
      configure: --with-gd --with-webp-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-zlib-dir=/usr --with-xpm-dir=/usr --with-freetype-dir=/usr --enable-gd-jis-conv --enable-gd-native-ttf
      build_dep: [libpng-dev, libjpeg-dev, libxpm-dev, libvpx-dev, zlib1g-dev, libfreetype6-dev, libwebp-dev]
      run_dep: [libpng12-0, libjpeg62-turbo, libxpm4, libvpx1, libfreetype6, libwebp-dev]
    all:
      type: builtin
      pre: ln -s /usr/lib/x86_64-linux-gnu/libXpm.* /usr/lib/
      configure: --with-gd --with-vpx-dir=/usr --with-jpeg-dir=/usr --with-png-dir=/usr --with-zlib-dir=/usr --with-xpm-dir=/usr --with-freetype-dir=/usr --enable-gd-jis-conv --enable-gd-native-ttf
      build_dep: [libpng-dev, libjpeg-dev, libxpm-dev, libvpx-dev, zlib1g-dev, libfreetype6-dev]
      run_dep: [libpng12-0, libjpeg62-turbo, libxpm4, libvpx1, libfreetype6]
  gettext:
    all:
      type: builtin
  gmp:
    all:
      type: builtin
      pre: ln /usr/include/x86_64-linux-gnu/gmp.h /usr/include/
      build_dep: [libgmp-dev]
  hash:
    all:
      type: builtin
  iconv:
    all:
      type: builtin
  igbinary:
    all:
      type: pecl
  imagick:
    7.2:
      type: pecl
      run_dep: [libmagickwand-6.q16-3]
    all:
      type: pecl
      build_dep: [libmagickwand-dev]
      run_dep: [libmagickwand-6.q16-2]
  imap:
    all:
      type: builtin
      pre: ln -s /usr/lib/x86_64-linux-gnu/libkrb5* /usr/lib/
      configure: --with-kerberos --with-imap-ssl --with-imap
      build_dep: [libc-client-dev, libkrb5-dev, libcurl4-openssl-dev]
      run_dep: [libc-client2007e]
  interbase:
    all:
      type: builtin
      build_dep: [libfbclient2, libib-util, firebird-dev]
      run_dep: [libfbclient2]
  intl:
    7.2:
      type: builtin
      run_dep: [libicu57]
    all:
      type: builtin
      build_dep: [libicu-dev]
      run_dep: [libicu52]
  json:
    all:
      type: builtin
  ldap:
    all:
      type: builtin
      pre: ln -s /usr/lib/x86_64-linux-gnu/libldap* /usr/lib/
      configure: --with-ldap --with-ldap-sasl
      build_dep: [libldap2-dev, libsasl2-dev]
  libxml:
    disabled: "{{ php_all_versions }}" # Available by default
  mbstring:
    all:
      type: builtin
  mcrypt:
    7.2:
      type: pecl
      version: 1.0.1
    all:
      type: builtin
      run_dep: [libmcrypt4]
      build_dep: [libmcrypt-dev]
  memcache:
    7.2:
      type: git
      git_url: https://github.com/websupport-sk/pecl-memcache
      configure: --with-zlib-dir=/usr
    7.1:
      type: git
      git_url: https://github.com/websupport-sk/pecl-memcache
      configure: --with-zlib-dir=/usr
    7.0:
      type: git
      git_url: https://github.com/websupport-sk/pecl-memcache
      configure: --with-zlib-dir=/usr
    all:
      type: pecl
      build_dep: [zlib1g-dev]
  memcached:
    5.4:
      type: pecl
      version: 2.2.0
    5.5:
      type: pecl
      version: 2.2.0
    5.6:
      type: pecl
      version: 2.2.0
    all:
      type: pecl
      build_dep: [zlib1g-dev, libmemcached-dev]
      run_dep: [libmemcachedutil2]
  mongodb:
    5.4:
      type: pecl
      version: 1.2.11
    all:
      type: pecl
      build_dep: [libssl-dev]
  msgpack:
    5.4:
      type: pecl
      version: 0.5.7
    5.5:
      type: pecl
      version: 0.5.7
    5.6:
      type: pecl
      version: 0.5.7
    all:
      type: pecl
  mysql:
    disabled: [7.0, 7.1, 7.2] # Deprecated in newer versions
    all:
      type: builtin
  mysqli:
    all:
      type: builtin
  mysqlnd:
    disabled: "{{ php_all_versions }}" # Available by default
  oci8:
    disabled: "{{ php_all_versions }}" # TODO: Oracle library is missing
  odbc:
    disabled: "{{ php_all_versions }}" # TODO: sqlext.h' not found!
  opcache:
    5.4:
      type: pecl
      command: pecl install zendopcache
    all:
      type: builtin
  openssl:
    disabled: "{{ php_all_versions }}" # Available by default
  pcntl:
    all:
      type: builtin
  pcre:
    disabled: "{{ php_all_versions }}" # Available by default
  pdo:
    all:
      type: builtin
  pdo_dblib:
    all:
      type: builtin
      pre: ln -s /usr/lib/x86_64-linux-gnu/libsybdb.* /usr/lib/
      build_dep: [freetds-dev]
      run_dep: [libsybdb5]
  pdo_firebird:
    all:
      type: builtin
      build_dep: [libfbclient2, libib-util, firebird-dev]
      run_dep: [libfbclient2]
  pdo_mysql:
    all:
      type: builtin
      configure: --with-zlib-dir=/usr
      build_dep: [zlib1g-dev]
  pdo_oci:
    disabled: "{{ php_all_versions }}" # TODO: Oracle library is missing
  pdo_odbc:
    disabled: "{{ php_all_versions }}" # TODO: Build errors
  pdo_pgsql:
    all:
      type: builtin
      build_dep: [libpq-dev]
      run_dep: [libpq5]
  pdo_sqlite:
    all:
      type: builtin
      build_dep: [libsqlite3-dev]
  pgsql:
    all:
      type: builtin
      build_dep: [libpq-dev]
      run_dep: [libpq5]
  phalcon:
    5.4:
      type: git
      git_url: https://github.com/phalcon/cphalcon
      git_ref: phalcon-v2.0.13
      command: cd build && ./install
    all:
      type: git
      git_url: https://github.com/phalcon/cphalcon
      git_ref: $(git for-each-ref --format='%(*creatordate:raw)%(creatordate:raw) %(refname)' refs/tags | sort -n | tail -1 | sed 's/^.*tags\///g')
      command: cd build && ./install
  phar:
    all:
      type: builtin
      build_dep: [libssl-dev]
  posix:
    all:
      type: builtin
  pspell:
    all:
      type: builtin
      build_dep: [libpspell-dev]
      run_dep: [libaspell15]
  readline:
    disabled: [5.4] # Available by default
    all:
      type: builtin
      build_dep: [libedit-dev, libreadline-dev]
  recode:
    all:
      type: builtin
      build_dep: [librecode-dev]
      run_dep: [librecode0]
  redis:
    all:
      type: pecl
  session:
    all:
      type: builtin
      configure: --with-mm
      build_dep: [libmm-dev]
  shmop:
    all:
      type: builtin
  simplexml:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  snmp:
    all:
      type: builtin
      configure: --with-openssl-dir
      build_dep: [libssl-dev, libsnmp-dev, snmp]
      run_dep: [snmp]
  soap:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  sockets:
    all:
      type: builtin
  sodium:
    disabled: [5.4, 5.5, 5.6, 7.0, 7.1]
    7.2:
      type: builtin
      build_dep: [libsodium-dev]
  spl:
    disabled: "{{ php_all_versions }}" # TODO: Did not work
  swoole:
    5.4:
      type: pecl
      version: 1.9.23
    5.5:
      type: pecl
      version: 1.9.23
    5.6:
      type: pecl
      version: 1.9.23
    7.2:
      type: pecl
      run_dep: [libnghttp2-14]
    all:
      type: pecl
      build_dep: [libnghttp2-dev, libssl-dev]
      run_dep: [libnghttp2-5]
  sysvmsg:
    all:
      type: builtin
  sysvsem:
    all:
      type: builtin
  sysvshm:
    all:
      type: builtin
  tidy:
    7.2:
      type: builtin
      run_dep: [libtidy5]
    all:
      type: builtin
      build_dep: [libtidy-dev]
      run_dep: [libtidy-0.99-0]
  tokenizer:
    all:
      type: builtin
  uploadprogress:
    7.2:
      type: git
      git_url: https://github.com/php/pecl-php-uploadprogress
      configure: --enable-uploadprogress
    7.1:
      type: git
      git_url: https://github.com/php/pecl-php-uploadprogress
      configure: --enable-uploadprogress
    7.0:
      type: git
      git_url: https://github.com/php/pecl-php-uploadprogress
      configure: --enable-uploadprogress
    all:
      type: pecl
  wddx:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  xdebug:
    5.4:
      type: pecl
      version: 2.4.1
    5.5:
      type: pecl
      version: 2.4.1
    5.6:
      type: pecl
      version: 2.4.1
    all:
      type: pecl
  xml:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  xmlreader:
    disabled: [7.0, 7.1, 7.2] # Available by default
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  xmlrpc:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr --with-iconv-dir=/usr
      build_dep: [libxml2-dev]
  xmlwriter:
    all:
      type: builtin
      configure: --with-libxml-dir=/usr
      build_dep: [libxml2-dev]
  xsl:
    all:
      type: builtin
      build_dep: [libxslt-dev]
      run_dep: [libxslt1.1]
  zip:
    5.4:
      type: builtin
      configure: --with-zlib-dir=/usr --with-pcre-dir=/usr
      build_dep: [zlib1g-dev]
      run_dep: []
    5.5:
      type: builtin
      configure: --with-zlib-dir=/usr --with-pcre-dir=/usr
      build_dep: [zlib1g-dev]
      run_dep: []
    7.2:
      type: builtin
      run_dep: [libzip4]
    all:
      type: builtin
      configure: --with-zlib-dir=/usr --with-pcre-dir=/usr --with-libzip
      build_dep: [zlib1g-dev, libzip-dev]
      run_dep: [libzip2]
